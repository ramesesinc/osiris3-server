import com.rameses.annotations.*;
import com.rameses.util.*;
import java.rmi.server.*;
import com.rameses.services.extended.*;

class AFControlTransferService extends AbstractCrudService {

	@PersistenceContext("main")
	def em
	
	@Service("DateService")
	def dateSvc;

	@Service("SequenceService")
	def seqSvc;

	@Service("AFControlPostService")
	def afCtrl;

	@Env
	def env;

	String schemaName = "afcontrol";
	String subSchemaName = "transfer";


	public void beforeCreate(o) {
		o.dtposted = dateSvc.serverDate;
		o.txnno = "AFTRNSFR" + seqSvc.getNextFormattedSeries( "AFTRNSFR" )
		o.user = [objid: env.USERID, name: env.USER];
	}
	
	public void afterCreate(o) {
		def detail = [:];
		detail.controlid = o.controlid;
		detail.refid = o.objid;
		detail.refdate = o.dtposted;
		detail.reftype = "TRANSFER";
		detail.issueto = o.to;
		afCtrl.postTransfer(detail);
	}

}
