import com.rameses.annotations.*;
import com.rameses.util.*;

class WebPasswordService
{
    @Env
    def env;

	@Service('AdminUserService')
	def userSvc;

	@Service('AdminSessionService')
	def sessionSvc;

	@After(pattern="PasswordService.changePassword", eval="env.CLIENTTYPE=='web'") 
	public void changePassword( evt ) {
		if (!env.SESSIONID) throw new Exception('Please specify SESSIONID');

		def sessInfo = sessionSvc.getSession( env.SESSIONID );
		if (!sessInfo) throw new Exception('INVALID_SESSION');

		def userInfo = userSvc.getInfo( sessInfo.username );
		if (!userInfo) throw new Exception('INVALID_USER_ACCOUNT'); 

		def result = evt.result;
		result.username = sessInfo.username;
		result.oldpassword = userInfo.pwd;		
		result.newpassword = evt.args[0].newpassword;
		userSvc.changePassword( result ); 
	}
	
}  

