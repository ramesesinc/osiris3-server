import com.rameses.annotations.*;
import com.rameses.common.*;
import java.rmi.server.UID

class DistrictOrgInterceptor {
	
	@PersistenceContext('main')	
	def em

	def schemaName = 'district';

	@After(pattern="OrgAdminService.create", eval="#{args[0].orgclass=='DISTRICT'}")
	public def onCreate( evt ) {
		def data = evt.args[0];
		data.state = 'DRAFT'; 
		em.create(schemaName, data); 
	}

	@After(pattern="OrgAdminService.update", eval="#{args[0].orgclass=='DISTRICT'}")
	public def onUpdate( evt ) {
		def data = evt.args[0];
		data.state = 'DRAFT'; 
		//create the record if not exist 
		def info = em.read(schemaName, data); 
		if (info) 
			em.update(schemaName, data); 
		else 
			em.create(schemaName, data);
	}

	@After(pattern="OrgAdminService.open", eval="#{args[0].orgclass=='DISTRICT'}")
	public def onOpen( evt ) {
		def orgdata = evt.args[0];
		def resdata = em.read(schemaName, orgdata);
		if (resdata) evt.result.putAll( resdata ); 
	} 
	
}
